<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${producto.nombre}">Detalle Producto</title>

  <!-- CSS propios -->
  <link rel="stylesheet" href="/CSS/Catalogo.css">
  <link rel="stylesheet" href="/CSS/Header.css">
  <link rel="stylesheet" href="/CSS/Footer.css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css">

  <style>
    /* Galería */
    .main-image{
      width:100%;
      height:350px;
      object-fit:cover;
      border-radius:12px;
    }
    .miniaturas-wrapper{
      margin-top:1rem;
    }
    .miniatura{
      width:70px;
      height:70px;
      object-fit:cover;
      border:2px solid #ccc;
      border-radius:6px;
      cursor:pointer;
      transition:border-color .2s, transform .2s;
    }
    .miniatura:hover{ border-color:#000; transform:scale(1.05);}
  </style>

  <!-- JS cabecera / pie (opcional) -->
  <script src="/JS/Header.js"></script>
  <script src="/JS/Footer.js"></script>
</head>
<body>

<!-- Header -->
<div th:replace="Header :: header"></div>

<div class="container my-5">
  <div class="row g-5">

    <!-- ──────── GALERÍA ────────-->
    <div class="col-md-6">
      <img th:src="@{${producto.variaciones[0].imageUrl}}"
           class="main-image"
           alt="Zapatilla">

      <div class="miniaturas-wrapper d-flex justify-content-center gap-2 flex-wrap">
        <img  th:each="var,stat:${producto.variaciones}"
              th:if="${stat.index < 4}"
              th:src="@{${var.imageUrl}}"
              th:attr="data-img-src=@{${var.imageUrl}},data-color=${var.color},data-precio=${var.precio}"
              class="miniatura"
              alt="color zapatilla">
      </div>
    </div>

    <!-- ──────── INFO / COMPRA ────────-->
    <div class="col-md-6">
      <h2 th:text="${producto.nombre}">Nombre</h2>
      <p th:text="${producto.descripcion}">Descripción</p>

      <ul class="list-unstyled mb-3">
        <li><strong>Marca:</strong> <span th:text="${producto.marca}">Marca</span></li>
        <li><strong>Tipo:</strong>  <span th:text="${producto.tipo}">Tipo</span></li>
        <li><strong>Género:</strong><span th:text="${producto.genero}">Género</span></li>
      </ul>

      <!-- Variación seleccionada -->
      <p class="fs-4 mb-1">
        <strong>Precio:</strong>
        <span id="precio-var" th:text="'S/ '+${producto.variaciones[0].precio}">S/ 0.00</span>
      </p>
      <p class="mb-4"><strong>Color:</strong> <span id="color-var"
                                                    th:text="${producto.variaciones[0].color}">Color</span></p>

      <!-- ──────── FORMULARIO CARRITO ────────-->
      <form th:action="@{/carrito/agregar}" method="post">
        <input type="hidden" name="productoId"       th:value="${producto.id}">
        <input type="hidden" name="colorSeleccionado" id="inputColor"  th:value="${producto.variaciones[0].color}">
        <input type="hidden" name="precioSeleccionado" id="inputPrecio" th:value="${producto.variaciones[0].precio}">
        <input type="hidden" name="talla" id="tallaSeleccionada" required>

        <!-- Guía tallas link -->
        <a href="#" class="d-block mb-2" data-bs-toggle="modal" data-bs-target="#guiaTallasModal">
          Guía de tallas
        </a>

        <!-- ──────── MODAL GUÍA TALLAS ────────-->
        <div class="modal fade" id="guiaTallasModal" tabindex="-1" aria-labelledby="guiaTallasLabel" aria-hidden="true">
          <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="guiaTallasLabel">Guía de tallas</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body p-0">
                <img src="/IMG/guia-tallas.png" alt="Guía de tallas" class="img-fluid w-100">
              </div>
            </div>
          </div>
        </div>

        <!-- Botones talla -->
        <div class="mb-3">
          <label class="form-label">Talla US</label>
          <div class="d-flex flex-wrap gap-2">
            <!-- Hombre o Unisex -->
            <button type="button" class="btn btn-outline-dark talla-btn"
                    th:each="t:${#numbers.sequence(7,12)}"
                    th:if="${producto.genero == 'Hombre' or producto.genero == 'Unisex'}"
                    th:text="${t}" th:attr="data-talla=${t}"></button>

            <!-- Mujer -->
            <button type="button" class="btn btn-outline-dark talla-btn"
                    th:each="t:${#numbers.sequence(5,10)}"
                    th:if="${producto.genero == 'Mujer'}"
                    th:text="${t}" th:attr="data-talla=${t}"></button>
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Agregar al carrito</button>
      </form>
    </div><!-- /col-md-6 info -->
  </div><!-- /row -->
</div><!-- /container -->

<!-- Footer -->
<div th:replace="Footer :: footer"></div>

<!-- ──────── SCRIPTS ────────-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    /* Cambiar imagen / precio / color */
    const mainImg  = document.querySelector('.main-image');
    const precioEl = document.getElementById('precio-var');
    const colorEl  = document.getElementById('color-var');
    const inColor  = document.getElementById('inputColor');
    const inPrecio = document.getElementById('inputPrecio');

    document.querySelectorAll('.miniatura').forEach(m => {
      m.addEventListener('click', () => {
        mainImg.src          = m.dataset.imgSrc;
        colorEl.textContent  = m.dataset.color;
        precioEl.textContent = 'S/ ' + parseFloat(m.dataset.precio).toFixed(2);
        inColor.value        = m.dataset.color;
        inPrecio.value       = m.dataset.precio;
      });
    });

    /* Seleccionar talla */
    const tallaBtns = document.querySelectorAll('.talla-btn');
    const tallaInput= document.getElementById('tallaSeleccionada');

    tallaBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        tallaBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        tallaInput.value = btn.dataset.talla;
      });
    });
  });
</script>
</body>
</html>
